<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FinMango Trends Analyzer</title>
    <!-- Material Icons and Fonts -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Date Picker -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <!-- Google Charts -->
    <script src="https://www.gstatic.com/charts/loader.js"></script>
    
    <style>
        :root {
            /* FinMango Colors */
            --fm-orange: #FF8A2B;
            --fm-orange-light: #FFB067;
            --fm-orange-dark: #E66E00;
            --fm-green: #4CAF50;
            --fm-green-light: #7BC67E;
            --fm-green-dark: #3B8C3F;
            
            /* Surface Colors */
            --surface-1: #FFFFFF;
            --surface-2: #F8F9FA;
            --surface-3: #F1F3F4;
            --surface-4: #E8EAED;
            
            /* Text Colors */
            --text-primary: #1D1B20;
            --text-secondary: #49454F;
            --text-tertiary: #79747E;
            
            /* States */
            --state-hover: rgba(255, 138, 43, 0.08);
            --state-focus: rgba(255, 138, 43, 0.12);
            --state-pressed: rgba(255, 138, 43, 0.16);
            
            /* Elevation */
            --elevation-1: 0px 1px 3px rgba(0, 0, 0, 0.1);
            --elevation-2: 0px 4px 6px rgba(0, 0, 0, 0.1);
            
            /* Animation */
            --transition-speed: 200ms;
        }

        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--surface-2);
            color: var(--text-primary);
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
        }

        .top-app-bar {
            background: var(--surface-1);
            padding: 16px 24px;
            box-shadow: var(--elevation-1);
            display: flex;
            align-items: center;
            gap: 16px;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .page-title {
            font-size: 24px;
            font-weight: 600;
            color: var(--fm-orange);
            margin: 0;
        }

        .container {
            max-width: 1200px;
            margin: 24px auto;
            padding: 0 24px;
        }

        .card {
            background: var(--surface-1);
            border-radius: 16px;
            box-shadow: var(--elevation-1);
            padding: 24px;
            margin-bottom: 24px;
            transition: box-shadow var(--transition-speed);
        }

        .card:hover {
            box-shadow: var(--elevation-2);
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0 0 16px 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .section-title .material-icons {
            color: var(--fm-orange);
        }

        .filters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 24px;
        }

        .input-field {
            margin-bottom: 16px;
        }

        .input-label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .input-control {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--surface-4);
            border-radius: 8px;
            font-size: 16px;
            color: var(--text-primary);
            background: var(--surface-1);
            transition: all var(--transition-speed);
            box-sizing: border-box;
        }

        .input-control:focus {
            outline: none;
            border-color: var(--fm-orange);
            box-shadow: 0 0 0 3px rgba(255, 138, 43, 0.1);
        }

        .date-range-container {
            display: flex;
            gap: 16px;
            margin-bottom: 16px;
        }

        .date-range-container .input-field {
            flex: 1;
        }

        .preset-dates {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-bottom: 16px;
        }

        .preset-btn {
            padding: 6px 12px;
            border-radius: 16px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            border: 1px solid var(--surface-4);
            background: var(--surface-1);
            color: var(--text-secondary);
            transition: all var(--transition-speed);
        }

        .preset-btn:hover {
            background: var(--state-hover);
            border-color: var(--fm-orange);
            color: var(--fm-orange);
        }

        .preset-btn.active {
            background: var(--fm-orange);
            border-color: var(--fm-orange);
            color: white;
        }

        .search-terms {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .button-container {
            display: flex;
            gap: 12px;
            margin-top: 24px;
        }

        .btn {
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all var(--transition-speed);
            border: none;
        }

        .btn-primary {
            background: var(--fm-orange);
            color: white;
        }

        .btn-primary:hover {
            background: var(--fm-orange-dark);
        }

        .btn-secondary {
            background: transparent;
            border: 2px solid var(--fm-orange);
            color: var(--fm-orange);
        }

        .btn-secondary:hover {
            background: var(--state-hover);
        }

        .chart-container {
            height: 400px;
            margin-top: 24px;
        }

        .toast {
            position: fixed;
            bottom: 24px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--text-primary);
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            box-shadow: var(--elevation-2);
            z-index: 1000;
            display: none;
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .loading-spinner {
            width: 48px;
            height: 48px;
            border: 4px solid var(--surface-4);
            border-top: 4px solid var(--fm-orange);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .data-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin-top: 24px;
        }

        .data-table th {
            background: var(--surface-2);
            padding: 12px 16px;
            text-align: left;
            font-weight: 600;
            color: var(--text-secondary);
            border-bottom: 2px solid var(--surface-4);
        }

        .data-table td {
            padding: 12px 16px;
            border-bottom: 1px solid var(--surface-4);
        }

        .data-table tbody tr:hover {
            background: var(--state-hover);
        }

        @media (max-width: 768px) {
            .container {
                padding: 0 16px;
            }
            
            .date-range-container {
                flex-direction: column;
            }
            
            .button-container {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <header class="top-app-bar">
        <span class="material-icons" style="color: var(--fm-orange); font-size: 32px;">trending_up</span>
        <h1 class="page-title">FinMango Trends Analyzer</h1>
    </header>

    <main class="container">
        <div class="card">
            <h2 class="section-title">
                <span class="material-icons">date_range</span>
                Date Range Selection
            </h2>
            
            <div class="preset-dates" id="presetDates">
                <button class="preset-btn" data-days="7">7 Days</button>
                <button class="preset-btn" data-days="30">1 Month</button>
                <button class="preset-btn" data-days="90">3 Months</button>
                <button class="preset-btn" data-days="180">6 Months</button>
                <button class="preset-btn" data-days="365">1 Year</button>
                <button class="preset-btn" data-days="1825">5 Years</button>
                <button class="preset-btn" data-days="3650">10 Years</button>
                <button class="preset-btn active" data-days="5475">15 Years</button>
            </div>

            <div class="date-range-container">
                <div class="input-field">
                    <label class="input-label" for="startDate">Start Date</label>
                    <input type="text" id="startDate" class="input-control date-picker" placeholder="Select start date">
                </div>
                <div class="input-field">
                    <label class="input-label" for="endDate">End Date</label>
                    <input type="text" id="endDate" class="input-control date-picker" placeholder="Select end date">
                </div>
            </div>

            <h2 class="section-title">
                <span class="material-icons">location_on</span>
                Geographic Filters
            </h2>
            
            <div class="filters-grid">
                <div class="input-field">
                    <label class="input-label" for="geoType">Geographic Level</label>
                    <select id="geoType" class="input-control" onchange="updateGeoOptions()">
                        <option value="GLOBAL">Global</option>
                        <option value="COUNTRY">Country</option>
                        <option value="REGION">Region</option>
                        <option value="DMA">DMA (Metro Area)</option>
                    </select>
                </div>

                <div class="input-field">
                    <label class="input-label" for="geoValue">Geographic Area</label>
                    <select id="geoValue" class="input-control" disabled>
                        <option value="">Select area...</option>
                    </select>
                </div>

                <div class="input-field">
                    <label class="input-label" for="dataGranularity">Data Granularity</label>
                    <select id="dataGranularity" class="input-control">
                        <option value="DAILY">Daily</option>
                        <option value="WEEKLY">Weekly</option>
                        <option value="MONTHLY">Monthly</option>
                    </select>
                </div>
            </div>

            <h2 class="section-title">
                <span class="material-icons">search</span>
                Search Terms
            </h2>
            
            <div class="search-terms">
                <div class="input-field">
                    <input type="text" id="searchTerm1" class="input-control" placeholder="Enter search term 1">
                </div>
                <div class="input-field">
                    <input type="text" id="searchTerm2" class="input-control" placeholder="Enter search term 2">
                </div>
                <div class="input-field">
                    <input type="text" id="searchTerm3" class="input-control" placeholder="Enter search term 3">
                </div>
                <div class="input-field">
                    <input type="text" id="searchTerm4" class="input-control" placeholder="Enter search term 4">
                </div>
                <div class="input-field">
                    <input type="text" id="searchTerm5" class="input-control" placeholder="Enter search term 5">
                </div>
            </div>

            <div class="button-container">
                <button onclick="updateTrends()" class="btn btn-primary">
                    <span class="material-icons">trending_up</span>
                    View Trends
                </button>
                <button onclick="downloadCSV()" class="btn btn-secondary">
                    <span class="material-icons">download</span>
                    Download CSV
                </button>
            </div>
        </div>

        <div class="card">
            <h2 class="section-title">
                <span class="material-icons">analytics</span>
                Trends Visualization
            </h2>
            <div id="trendsChart" class="chart-container"></div>
            <div id="trendsData"></div>
        </div>
    </main>

    <div id="toast" class="toast"></div>
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-spinner"></div>
    </div>

    <script>
        const API_KEY = 'AIzaSyAlcRThhHSKrYdqGxFj7a4iCvt7Q2NiALc';
        let trendsData = [];

        // Initialize date pickers
        const today = new Date();
        const fifteenYearsAgo = new Date();
        fifteenYearsAgo.setFullYear(today.getFullYear() - 15);

        flatpickr('.date-picker', {
            maxDate: 'today',
            dateFormat: 'Y-m-d',
            onChange: function(selectedDates, dateStr, instance) {
                validateDateRange();
            }
        });

        // Initialize start and end dates
        document.getElementById('startDate').value = fifteenYearsAgo.toISOString().split('T')[0];
        document.getElementById('endDate').value = today.toISOString().split('T')[0];

        // Geographic data
        const geoData = {
            COUNTRY: {
                US: "United States",
                GB: "United Kingdom",
                CA: "Canada",
                AU: "Australia",
                IN: "India",
                DE: "Germany",
                FR: "France",
                BR: "Brazil",
                JP: "Japan",
                MX: "Mexico"
            },
            REGION: {
                "US-CA": "California",
                "US-NY": "New York",
                "US-TX": "Texas",
                "US-FL": "Florida",
                "US-IL": "Illinois",
                "US-PA": "Pennsylvania",
                "US-OH": "Ohio",
                "US-GA": "Georgia",
                "US-MI": "Michigan",
                "US-NC": "North Carolina"
            },
            DMA: {
                "501": "New York",
                "803": "Los Angeles",
                "807": "San Francisco-Oakland-San Jose",
                "602": "Chicago",
                "506": "Boston",
                "623": "Dallas-Fort Worth",
                "528": "Miami-Fort Lauderdale",
                "751": "Denver",
                "819": "Cleveland",
                "825": "San Diego"
            }
        };

        function showToast(message, duration = 3000) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.style.display = 'block';
            setTimeout(() => {
                toast.style.display = 'none';
            }, duration);
        }

        function validateDateRange() {
            const startDate = new Date(document.getElementById('startDate').value);
            const endDate = new Date(document.getElementById('endDate').value);
            
            if (endDate < startDate) {
                showToast('End date must be after start date');
                return false;
            }

            const diffTime = Math.abs(endDate - startDate);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            if (diffDays > 5475) {
                showToast('Date range cannot exceed 15 years');
                return false;
            }

            return true;
        }

        function updateGeoOptions() {
            const geoType = document.getElementById('geoType').value;
            const geoSelect = document.getElementById('geoValue');
            geoSelect.innerHTML = '<option value="">Select area...</option>';
            
            if (geoType === 'GLOBAL') {
                geoSelect.disabled = true;
                return;
            }

            geoSelect.disabled = false;
            const options = geoData[geoType] || {};
            
            Object.entries(options).forEach(([value, label]) => {
                const option = document.createElement('option');
                option.value = value;
                option.textContent = label;
                geoSelect.appendChild(option);
            });
        }

       async function fetchTrendsData(terms) {
    if (!validateDateRange()) {
        return;
    }

    const validTerms = terms.filter(term => term.trim() !== '');
    if (validTerms.length === 0) {
        showToast('Please enter at least one search term');
        return;
    }

    const startDate = document.getElementById('startDate').value;
    const endDate = document.getElementById('endDate').value;
    const geoType = document.getElementById('geoType').value;
    const geoValue = document.getElementById('geoValue').value;
    const granularity = document.getElementById('dataGranularity').value;

    document.getElementById('loadingOverlay').style.display = 'flex';

    try {
        // Create the request parameters
        const params = new URLSearchParams({
            key: API_KEY, // API key in URL parameters
            geo: geoType === 'GLOBAL' ? '' : geoValue,
            time: `${startDate} ${endDate}`,
            resolution: granularity.toLowerCase()
        });

        const searchTermsParam = validTerms.map(term => `q=${encodeURIComponent(term)}`).join('&');
        const url = `https://trends.googleapis.com/trends/api/explore?${params}&${searchTermsParam}`;

        // Make the API request
        const response = await fetch(url);

        if (!response.ok) {
            throw new Error(`API request failed: ${response.status}`);
        }

        const data = await response.json();
        trendsData = processData(data);
        displayData(trendsData);
        displayChart(trendsData);
    } catch (error) {
        console.error('Error fetching data:', error);
        showToast('Error: ' + error.message);
    } finally {
        document.getElementById('loadingOverlay').style.display = 'none';
    }
}

        function processData(data) {
            if (!data || !data.timelineData) {
                return [];
            }

            return data.timelineData.map(point => ({
                date: new Date(point.timestamp * 1000).toLocaleDateString(),
                ...point.values.reduce((acc, val, idx) => {
                    acc[`term${idx + 1}`] = val.value;
                    return acc;
                }, {})
            }));
        }

        function displayData(data) {
            const table = document.createElement('table');
            table.className = 'data-table';
            
            if (data.length === 0) {
                document.getElementById('trendsData').innerHTML = 'No data available';
                return;
            }

            // Create headers
            const headers = Object.keys(data[0]);
            const headerRow = document.createElement('tr');
            headers.forEach(header => {
                const th = document.createElement('th');
                th.textContent = header.charAt(0).toUpperCase() + header.slice(1);
                headerRow.appendChild(th);
            });
            table.appendChild(headerRow);

            // Create data rows
            data.forEach(row => {
                const tr = document.createElement('tr');
                headers.forEach(header => {
                    const td = document.createElement('td');
                    td.textContent = row[header];
                    tr.appendChild(td);
                });
                table.appendChild(tr);
            });

            const dataDiv = document.getElementById('trendsData');
            dataDiv.innerHTML = '';
            dataDiv.appendChild(table);
        }

        function displayChart(data) {
            google.charts.load('current', {'packages':['corechart']});
            google.charts.setOnLoadCallback(() => {
                const dataTable = new google.visualization.DataTable();
                dataTable.addColumn('string', 'Date');
                
                // Add columns for each term
                const terms = Object.keys(data[0]).filter(key => key !== 'date');
                terms.forEach(term => {
                    dataTable.addColumn('number', term);
                });

                // Add rows
                const chartData = data.map(point => {
                    return [point.date, ...terms.map(term => point[term])];
                });
                dataTable.addRows(chartData);

                const options = {
                    title: 'Google Trends Data',
                    curveType: 'function',
                    legend: { position: 'bottom' },
                    colors: ['#FF8A2B', '#4CAF50', '#2196F3', '#9C27B0', '#FF5722'],
                    backgroundColor: '#FFFFFF',
                    chartArea: {
                        width: '80%',
                        height: '70%'
                    },
                    vAxis: {
                        title: 'Search Interest',
                        minValue: 0
                    },
                    hAxis: {
                        title: 'Date'
                    }
                };

                const chart = new google.visualization.LineChart(document.getElementById('trendsChart'));
                chart.draw(dataTable, options);
            });
        }

        function downloadCSV() {
            if (trendsData.length === 0) {
                showToast('No data available to download');
                return;
            }

            const headers = Object.keys(trendsData[0]);
            const csvRows = [
                headers.join(','),
                ...trendsData.map(row => headers.map(header => row[header]).join(','))
            ];

            const csvContent = csvRows.join('\n');
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `trends_data_${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }

        // Handle preset date buttons
        document.getElementById('presetDates').addEventListener('click', (e) => {
            if (e.target.classList.contains('preset-btn')) {
                const days = parseInt(e.target.dataset.days);
                const endDate = new Date();
                const startDate = new Date();
                startDate.setDate(endDate.getDate() - days);
                
                document.getElementById('startDate').value = startDate.toISOString().split('T')[0];
                document.getElementById('endDate').value = endDate.toISOString().split('T')[0];
                
                document.querySelectorAll('.preset-btn').forEach(btn => btn.classList.remove('active'));
                e.target.classList.add('active');
            }
        });

        function updateTrends() {
            const terms = [
                document.getElementById('searchTerm1').value,
                document.getElementById('searchTerm2').value,
                document.getElementById('searchTerm3').value,
                document.getElementById('searchTerm4').value,
                document.getElementById('searchTerm5').value
            ].filter(term => term.trim() !== '');

            fetchTrendsData(terms);
        }

        // Initialize the page
        window.onload = function() {
            updateGeoOptions();
            document.getElementById('searchTerm1').value = 'financial literacy';
        }
    </script>
</body>
</html>
